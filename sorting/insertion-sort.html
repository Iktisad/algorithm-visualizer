<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Insertion Sort</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      .bar {
        transition: background-color 0.15s ease, transform 0.15s ease;
      }
      .bar-container {
        min-height: 280px;
        overflow-x: auto;
        overflow-y: hidden;
      }
      .pseudocode-highlight {
        background-color: #dbeafe !important;
        border-left: 3px solid #3b82f6;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
      <!-- Breadcrumb Navigation -->
      <nav class="mb-6" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-sm text-gray-600">
          <li>
            <a
              href="../index.html"
              class="flex items-center hover:text-blue-600 transition-colors"
            >
              <svg
                class="w-4 h-4 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 5a2 2 0 012-2h4a2 2 0 012 2v3H8V5z"
                ></path>
              </svg>
              Algorithms Lab
            </a>
          </li>
          <li class="flex items-center">
            <svg
              class="w-4 h-4 text-gray-400"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                clip-rule="evenodd"
              ></path>
            </svg>
            <span class="ml-2 text-gray-500">Sorting</span>
          </li>
          <li class="flex items-center">
            <svg
              class="w-4 h-4 text-gray-400"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                clip-rule="evenodd"
              ></path>
            </svg>
            <span class="ml-2 font-medium text-gray-900">Insertion Sort</span>
          </li>
        </ol>
      </nav>

      <h1 class="text-4xl font-bold text-center mb-8 text-gray-800">
        Insertion Sort
      </h1>

      <!-- Bento Grid Layout -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Pseudocode Panel -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Pseudocode</h2>
          <div class="bg-gray-50 rounded-lg p-4 font-mono text-sm">
            <div id="line1" class="py-2 px-3 rounded transition-colors">
              <span class="text-purple-600">for</span> i = 1
              <span class="text-purple-600">to</span> n-1:
            </div>
            <div id="line2" class="py-2 px-3 rounded transition-colors ml-4">
              key = array[i]
            </div>
            <div id="line3" class="py-2 px-3 rounded transition-colors ml-4">
              j = i - 1
            </div>
            <div id="line4" class="py-2 px-3 rounded transition-colors ml-4">
              <span class="text-purple-600">while</span> j >= 0 <span class="text-purple-600">and</span> array[j] > key:
            </div>
            <div id="line5" class="py-2 px-3 rounded transition-colors ml-8">
              array[j+1] = array[j]
            </div>
            <div id="line6" class="py-2 px-3 rounded transition-colors ml-8">
              j = j - 1
            </div>
            <div id="line7" class="py-2 px-3 rounded transition-colors ml-4">
              array[j+1] = key
            </div>
          </div>
          <div class="mt-4 text-sm text-gray-600">
            <p class="mb-2">
              <strong>Current line highlighted</strong> shows which part of the
              algorithm is executing.
            </p>
            <p class="text-xs">
              Insertion sort builds the sorted array one element at a time by inserting each element into its correct position.
            </p>
          </div>
        </div>

        <!-- Visualization Panel -->
        <div class="md:col-span-2 bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">
            Insertion Sort Visualization
          </h2>
          <div class="mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h3 class="font-semibold text-blue-900 mb-2">
              How Insertion Sort Works
            </h3>
            <p class="text-sm text-blue-800">
              Insertion Sort builds the sorted array one item at a time. It takes each element and inserts it into its correct position in the already sorted portion. Watch the
              <span class="font-semibold text-purple-600">purple bar</span> (key element being inserted),
              <span class="font-semibold text-amber-600">yellow bars</span> (elements being compared),
              <span class="font-semibold text-cyan-600">cyan bars</span> (elements being shifted), and
              <span class="font-semibold text-green-600">green bars</span> showing sorted elements.
            </p>
          </div>
          <div
            id="arrayContainer"
            class="bar-container min-h-64 flex items-end justify-start space-x-1 border-2 border-gray-200 rounded p-4 bg-gray-50"
          >
            <div class="text-gray-500 m-auto">
              Click "Generate Array" to start
            </div>
          </div>
          <div id="stepInfo" class="mt-4 text-center text-sm text-gray-600">
            Ready to sort
          </div>

          <!-- Controls -->
          <div class="mt-6 flex flex-wrap items-center gap-4 justify-center">
            <div class="flex items-center gap-2">
              <label for="arraySize" class="text-sm font-medium">Size:</label>
              <input
                id="arraySize"
                type="range"
                min="5"
                max="120"
                value="20"
                class="w-20"
              />
              <span id="sizeDisplay" class="text-sm w-8">20</span>
            </div>

            <div class="flex items-center gap-2">
              <label for="speed" class="text-sm font-medium">Speed:</label>
              <input
                id="speed"
                type="range"
                min="1"
                max="10"
                value="5"
                class="w-20"
              />
            </div>

            <button
              id="generateBtn"
              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
            >
              Generate Array
            </button>

            <button
              id="sortBtn"
              class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
            >
              ▶ Play
            </button>

            <button
              id="stepBtn"
              class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors"
            >
              ⏭ Step
            </button>

            <button
              id="resetBtn"
              class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
            >
              Reset
            </button>
          </div>
        </div>

        <!-- Algorithm Info -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Algorithm Info</h2>
          <div class="space-y-3 text-sm">
            <div>
              <span class="font-semibold">Time Complexity:</span>
              <div class="ml-2">
                <div>Best: O(n)</div>
                <div>Average: O(n²)</div>
                <div>Worst: O(n²)</div>
              </div>
            </div>
            <div><span class="font-semibold">Space Complexity:</span> O(1)</div>
            <div><span class="font-semibold">Stable:</span> Yes</div>
            <div><span class="font-semibold">In-Place:</span> Yes</div>
          </div>
        </div>

        <!-- Performance Metrics -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Performance</h2>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-sm font-medium">Array Size:</span>
              <span id="currentSize" class="text-sm">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm font-medium">Comparisons:</span>
              <span id="comparisons" class="text-sm">0</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm font-medium">Shifts:</span>
              <span id="shifts" class="text-sm">0</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm font-medium">Actual Time:</span>
              <span id="actualTime" class="text-sm">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm font-medium">Theoretical:</span>
              <span id="theoreticalTime" class="text-sm">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm font-medium">Passes:</span>
              <span id="passes" class="text-sm">0</span>
            </div>
          </div>
        </div>

        <!-- Complexity Graph -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">
            Complexity Analysis
          </h2>
          <div style="position: relative; height: 200px; width: 100%">
            <canvas id="complexityChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <script>
      class InsertionSortVisualizer {
        constructor() {
          this.array = [];
          this.originalArray = [];
          this.isAnimating = false;
          this.isPaused = false;
          this.animationSpeed = 500;
          this.currentI = 1;
          this.currentJ = 0;
          this.key = null;
          this.comparisons = 0;
          this.shifts = 0;
          this.passes = 0;
          this.startTime = 0;
          this.stepMode = false;
          this.stepPhase = null;

          this.initializeEventListeners();
          this.initializeChart();
          this.generateArray();
        }

        initializeEventListeners() {
          document.getElementById("generateBtn").addEventListener("click", () => this.generateArray());
          document.getElementById("sortBtn").addEventListener("click", () => this.togglePlayPause());
          document.getElementById("stepBtn").addEventListener("click", () => this.startStepMode());
          document.getElementById("resetBtn").addEventListener("click", () => this.reset());
          document.getElementById("speed").addEventListener("input", (e) => {
            this.animationSpeed = 1100 - parseInt(e.target.value) * 100;
          });

          const arraySizeSlider = document.getElementById("arraySize");
          const arraySizeDisplay = document.getElementById("sizeDisplay");
          arraySizeSlider.addEventListener("input", (e) => {
            arraySizeDisplay.textContent = e.target.value;
          });
        }

        generateArray() {
          const size = Math.min(120, Math.max(5, parseInt(document.getElementById("arraySize").value)));
          document.getElementById("arraySize").value = size;

          this.isAnimating = false;
          this.isPaused = false;
          this.stepMode = false;
          this.currentI = 1;
          this.currentJ = 0;
          this.key = null;
          this.stepPhase = null;

          const sortBtn = document.getElementById("sortBtn");
          const stepBtn = document.getElementById("stepBtn");
          if (sortBtn) {
            sortBtn.innerHTML = "▶ Play";
            sortBtn.disabled = false;
          }
          if (stepBtn) {
            stepBtn.disabled = false;
            stepBtn.innerHTML = "⏭ Step";
          }

          this.array = Array.from({ length: size }, (_, i) => i + 1);
          this.originalArray = [...this.array];
          this.shuffleArray();
          this.renderArray();
          this.resetMetrics();
          this.updatePerformanceMetrics();
          this.highlightPseudocode(null);
          document.getElementById("stepInfo").textContent = "Ready to sort";
        }

        shuffleArray() {
          for (let i = this.array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [this.array[i], this.array[j]] = [this.array[j], this.array[i]];
          }
        }

        renderArray() {
          const container = document.getElementById("arrayContainer");
          const n = this.array.length;

          container.innerHTML = "";

          if (n === 0) {
            container.innerHTML = '<div class="text-gray-500 m-auto">Click "Generate Array" to start</div>';
            return;
          }

          const maxValue = Math.max(...this.array);
          const containerWidth = container.clientWidth - 32;

          let barWidth, fontSize, showLabels = true;

          if (n <= 20) {
            barWidth = Math.max(20, Math.min(40, containerWidth / n - 4));
            fontSize = "12px";
          } else if (n <= 50) {
            barWidth = Math.max(12, containerWidth / n - 2);
            fontSize = "10px";
          } else if (n <= 80) {
            barWidth = Math.max(8, containerWidth / n - 1);
            fontSize = "8px";
            showLabels = false;
          } else {
            barWidth = Math.max(4, containerWidth / n - 0.5);
            showLabels = false;
          }

          const fragment = document.createDocumentFragment();

          this.array.forEach((value, index) => {
            const bar = document.createElement("div");
            const height = (value / maxValue) * 220;

            bar.className = "bar";
            bar.style.width = `${barWidth}px`;
            bar.style.height = `${height}px`;
            bar.style.minHeight = "4px";
            bar.style.backgroundColor = "#3B82F6";
            bar.style.display = "flex";
            bar.style.alignItems = "end";
            bar.style.justifyContent = "center";
            bar.style.flexShrink = "0";
            bar.dataset.index = index;
            bar.dataset.value = value;

            if (showLabels) {
              const label = document.createElement("span");
              label.textContent = value;
              label.style.fontSize = fontSize;
              label.style.color = "white";
              label.style.fontWeight = "bold";
              label.style.textShadow = "1px 1px 1px rgba(0,0,0,0.5)";
              label.style.userSelect = "none";
              bar.appendChild(label);
            }

            fragment.appendChild(bar);
          });

          container.appendChild(fragment);
        }

        highlightBars(indices, colors) {
          const bars = document.querySelectorAll(".bar");
          bars.forEach((bar, index) => {
            const colorMap = new Map(indices.map((idx, i) => [idx, Array.isArray(colors) ? colors[i] : colors]));
            if (colorMap.has(index)) {
              bar.style.backgroundColor = colorMap.get(index);
              bar.style.transform = "scale(1.05)";
            } else if (index < this.currentI) {
              bar.style.backgroundColor = "#10B981";
              bar.style.transform = "scale(1)";
            } else {
              bar.style.backgroundColor = "#3B82F6";
              bar.style.transform = "scale(1)";
            }
          });
        }

        async shiftElement(from, to) {
          return new Promise((resolve) => {
            const bars = document.querySelectorAll(".bar");
            if (!bars[from]) {
              resolve();
              return;
            }

            const bar = bars[from];
            const barWidth = bar.offsetWidth + 2;
            const distance = (to - from) * barWidth;

            bar.style.transform = `translateX(${distance}px) scale(1.05)`;

            setTimeout(() => {
              bar.style.transform = "scale(1)";
              resolve();
            }, 200);
          });
        }

        togglePlayPause() {
          if (this.stepMode && !this.isAnimating) {
            this.reset();
            return;
          }

          if (this.isAnimating && !this.stepMode && !this.isPaused) {
            this.pauseAnimation();
          } else if (this.isPaused) {
            this.resumeAnimation();
          } else {
            this.startAutoSort();
          }
        }

        async startAutoSort() {
          if (this.isAnimating) return;

          if (!this.isPaused) {
            this.currentI = 1;
            this.currentJ = 0;
            this.key = null;
            this.resetMetrics();
          }

          this.isAnimating = true;
          this.stepMode = false;
          if (this.startTime === 0) {
            this.startTime = performance.now();
          }

          const sortBtn = document.getElementById("sortBtn");
          sortBtn.innerHTML = "⏸ Pause";
          const stepBtn = document.getElementById("stepBtn");
          if (stepBtn) stepBtn.disabled = true;

          await this.insertionSortAnimation();

          if (!this.isPaused) {
            this.isAnimating = false;
            sortBtn.innerHTML = "▶ Play";
            if (stepBtn) stepBtn.disabled = false;

            this.highlightBars(Array.from({ length: this.array.length }, (_, i) => i), "#10B981");
            this.highlightPseudocode(null);
            document.getElementById("stepInfo").textContent = "Sorting completed!";
          }
        }

        async insertionSortAnimation() {
          const n = this.array.length;

          for (let i = this.currentI; i < n && !this.isPaused; i++) {
            this.currentI = i;
            this.passes = i;

            this.highlightPseudocode(0);
            this.highlightBars([i], "#9333EA");
            document.getElementById("stepInfo").textContent = `Pass ${i}: Examining element at position ${i}`;
            await this.delay(this.animationSpeed);

            this.key = this.array[i];
            this.highlightPseudocode(1);
            document.getElementById("stepInfo").textContent = `Pass ${i}: Key = ${this.key}`;
            await this.delay(this.animationSpeed);

            this.currentJ = i - 1;
            this.highlightPseudocode(2);
            await this.delay(this.animationSpeed / 2);

            this.highlightPseudocode(3);
            while (this.currentJ >= 0 && this.array[this.currentJ] > this.key && !this.isPaused) {
              this.comparisons++;
              
              this.highlightBars([this.currentJ, i], ["#F59E0B", "#9333EA"]);
              document.getElementById("stepInfo").textContent = 
                `Pass ${i}: Comparing ${this.array[this.currentJ]} > ${this.key}, shifting right`;
              await this.delay(this.animationSpeed);

              this.highlightPseudocode(4);
              this.array[this.currentJ + 1] = this.array[this.currentJ];
              this.shifts++;
              await this.shiftElement(this.currentJ, this.currentJ + 1);
              this.renderArray();
              this.highlightBars([this.currentJ + 1, i], ["#06B6D4", "#9333EA"]);
              await this.delay(this.animationSpeed / 2);

              this.highlightPseudocode(5);
              this.currentJ--;
              await this.delay(this.animationSpeed / 2);

              this.highlightPseudocode(3);
              this.updatePerformanceMetrics();
            }

            if (this.currentJ >= 0) {
              this.comparisons++;
            }

            this.highlightPseudocode(6);
            this.array[this.currentJ + 1] = this.key;
            this.renderArray();
            this.highlightBars([this.currentJ + 1], "#10B981");
            document.getElementById("stepInfo").textContent = 
              `Pass ${i}: Inserted ${this.key} at position ${this.currentJ + 1}`;
            await this.delay(this.animationSpeed);

            this.updatePerformanceMetrics();
          }

          this.highlightPseudocode(null);
        }

        startStepMode() {
          if (this.isAnimating && !this.stepMode) return;

          if (!this.stepMode) {
            this.stepMode = true;
            this.isAnimating = true;
            this.isPaused = false;
            if (this.startTime === 0) {
              this.startTime = performance.now();
            }
            if (this.currentI === 1 && !this.stepPhase) {
              this.currentI = 1;
              this.currentJ = 0;
              this.key = null;
            }
            const stepBtn = document.getElementById("stepBtn");
            if (stepBtn) stepBtn.innerHTML = "⏭ Next";
            const sortBtn = document.getElementById("sortBtn");
            if (sortBtn) sortBtn.disabled = true;
          }

          this.insertionSortStep();
        }

        async insertionSortStep() {
          const n = this.array.length;
          if (!this.stepPhase) this.stepPhase = "outer";

          if (this.currentI >= n) {
            this.isAnimating = false;
            this.stepMode = false;
            this.stepPhase = null;
            const stepBtn = document.getElementById("stepBtn");
            const sortBtn = document.getElementById("sortBtn");
            if (stepBtn) {
              stepBtn.innerHTML = "⏭ Step";
              stepBtn.disabled = true;
            }
            if (sortBtn) sortBtn.disabled = false;
            this.highlightBars(Array.from({ length: n }, (_, i) => i), "#10B981");
            this.highlightPseudocode(null);
            document.getElementById("stepInfo").textContent = "Sorting completed!";
            return;
          }

          switch (this.stepPhase) {
            case "outer":
              this.highlightPseudocode(0);
              this.highlightBars([this.currentI], "#9333EA");
              document.getElementById("stepInfo").textContent = 
                `Pass ${this.currentI}: Examining element at position ${this.currentI}`;
              this.stepPhase = "key";
              break;

            case "key":
              this.key = this.array[this.currentI];
              this.highlightPseudocode(1);
              document.getElementById("stepInfo").textContent = 
                `Pass ${this.currentI}: Key = ${this.key}`;
              this.stepPhase = "setJ";
              break;

            case "setJ":
              this.currentJ = this.currentI - 1;
              this.highlightPseudocode(2);
              document.getElementById("stepInfo").textContent = 
                `Pass ${this.currentI}: Set j = ${this.currentJ}`;
              this.stepPhase = "while";
              break;

            case "while":
              this.highlightPseudocode(3);
              if (this.currentJ >= 0 && this.array[this.currentJ] > this.key) {
                this.comparisons++;
                this.highlightBars([this.currentJ, this.currentI], ["#F59E0B", "#9333EA"]);
                document.getElementById("stepInfo").textContent = 
                  `Pass ${this.currentI}: ${this.array[this.currentJ]} > ${this.key}, will shift`;
                this.stepPhase = "shift";
              } else {
                if (this.currentJ >= 0) this.comparisons++;
                this.stepPhase = "insert";
              }
              this.updatePerformanceMetrics();
              break;

            case "shift":
              this.highlightPseudocode(4);
              this.array[this.currentJ + 1] = this.array[this.currentJ];
              this.shifts++;
              await this.shiftElement(this.currentJ, this.currentJ + 1);
              this.renderArray();
              this.highlightBars([this.currentJ + 1], "#06B6D4");
              document.getElementById("stepInfo").textContent = 
                `Pass ${this.currentI}: Shifted element to position ${this.currentJ + 1}`;
              this.stepPhase = "decJ";
              this.updatePerformanceMetrics();
              break;

            case "decJ":
              this.highlightPseudocode(5);
              this.currentJ--;
              document.getElementById("stepInfo").textContent = 
                `Pass ${this.currentI}: Decremented j to ${this.currentJ}`;
              this.stepPhase = "while";
              break;

            case "insert":
              this.highlightPseudocode(6);
              this.array[this.currentJ + 1] = this.key;
              this.renderArray();
              this.highlightBars([this.currentJ + 1], "#10B981");
              document.getElementById("stepInfo").textContent = 
                `Pass ${this.currentI}: Inserted ${this.key} at position ${this.currentJ + 1}`;
              this.currentI++;
              this.passes = this.currentI - 1;
              this.stepPhase = "outer";
              this.updatePerformanceMetrics();
              break;
          }
        }

        pauseAnimation() {
          this.isPaused = true;
          this.stepMode = true;
          const sortBtn = document.getElementById("sortBtn");
          sortBtn.innerHTML = "▶ Play";
          const stepBtn = document.getElementById("stepBtn");
          if (stepBtn) {
            stepBtn.disabled = false;
            stepBtn.innerHTML = "⏭ Next";
          }
          document.getElementById("stepInfo").textContent = 
            "Paused - Click Play to continue or Step to advance manually";
        }

        resumeAnimation() {
          this.isPaused = false;
          this.stepMode = false;
          this.stepPhase = null;
          const sortBtn = document.getElementById("sortBtn");
          sortBtn.innerHTML = "⏸ Pause";
          const stepBtn = document.getElementById("stepBtn");
          if (stepBtn) {
            stepBtn.disabled = true;
            stepBtn.innerHTML = "⏭ Step";
          }
          document.getElementById("stepInfo").textContent = "Sorting...";
          this.insertionSortAnimation();
        }

        highlightPseudocode(lineNumber) {
          const lines = ["line1", "line2", "line3", "line4", "line5", "line6", "line7"];
          lines.forEach((lineId, index) => {
            const element = document.getElementById(lineId);
            if (element) {
              if (index === lineNumber) {
                element.classList.add("pseudocode-highlight");
              } else {
                element.classList.remove("pseudocode-highlight");
              }
            }
          });
        }

        reset() {
          this.isAnimating = false;
          this.isPaused = false;
          this.stepMode = false;
          this.currentI = 1;
          this.currentJ = 0;
          this.key = null;
          this.stepPhase = null;

          const sortBtn = document.getElementById("sortBtn");
          const stepBtn = document.getElementById("stepBtn");

          if (sortBtn) {
            sortBtn.innerHTML = "▶ Play";
            sortBtn.disabled = false;
          }

          if (stepBtn) {
            stepBtn.disabled = false;
            stepBtn.innerHTML = "⏭ Step";
          }

          if (this.originalArray.length > 0) {
            this.array = [...this.originalArray];
            this.shuffleArray();
            this.renderArray();
          }

          this.resetMetrics();
          this.updatePerformanceMetrics();
          this.highlightPseudocode(null);
          document.getElementById("stepInfo").textContent = "Ready to sort";
        }

        resetMetrics() {
          this.comparisons = 0;
          this.shifts = 0;
          this.passes = 0;
          this.startTime = 0;
        }

        updatePerformanceMetrics() {
          const n = this.array.length;
          const currentTime = this.startTime > 0 ? (performance.now() - this.startTime).toFixed(2) : 0;
          const worstComparisons = (n * (n - 1)) / 2;
          const bestComparisons = n - 1;

          document.getElementById("currentSize").textContent = n;
          document.getElementById("comparisons").textContent = this.comparisons;
          document.getElementById("shifts").textContent = this.shifts;
          document.getElementById("actualTime").textContent = currentTime + " ms";
          document.getElementById("theoreticalTime").textContent = 
            `Best: ${bestComparisons}, Worst: ${worstComparisons}`;
          document.getElementById("passes").textContent = this.passes;
        }

        delay(ms) {
          return new Promise((resolve) => setTimeout(resolve, ms));
        }

        initializeChart() {
          const ctx = document.getElementById("complexityChart").getContext("2d");
          const sizes = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120];

          new Chart(ctx, {
            type: "line",
            data: {
              labels: sizes,
              datasets: [
                {
                  label: "Best Case O(n)",
                  data: sizes.map((n) => n - 1),
                  borderColor: "#10B981",
                  backgroundColor: "rgba(16, 185, 129, 0.1)",
                  tension: 0.1,
                  pointRadius: 3,
                  borderWidth: 2,
                },
                {
                  label: "Average Case O(n²)",
                  data: sizes.map((n) => (n * (n - 1)) / 4),
                  borderColor: "#F59E0B",
                  backgroundColor: "rgba(245, 158, 11, 0.1)",
                  tension: 0.1,
                  pointRadius: 3,
                  borderWidth: 2,
                },
                {
                  label: "Worst Case O(n²)",
                  data: sizes.map((n) => (n * (n - 1)) / 2),
                  borderColor: "#EF4444",
                  backgroundColor: "rgba(239, 68, 68, 0.1)",
                  tension: 0.1,
                  pointRadius: 3,
                  borderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: "Operations",
                  },
                },
                x: {
                  title: {
                    display: true,
                    text: "Array Size",
                  },
                },
              },
              plugins: {
                legend: {
                  display: true,
                  position: "top",
                  labels: {
                    font: {
                      size: 10,
                    },
                  },
                },
              },
            },
          });
        }
      }

      const visualizer = new InsertionSortVisualizer();
    </script>
  </body>
</html>